# 系统架构设计

## 整体架构

全局翻译工具采用分层架构设计，分为以下几个层次：

```
┌─────────────────┐
│   用户交互层      │
├─────────────────┤
│ 全局快捷键监听    │
│ 区域选择界面      │
│ 浮动翻译窗口      │
│ 系统托盘图标      │
└─────────────────┘
         ↓
┌─────────────────┐
│   核心服务层      │
├─────────────────┤
│ 屏幕捕获服务      │
│ OCR识别服务      │
│ 翻译处理服务      │
│ 配置管理服务      │
└─────────────────┘
         ↓
┌─────────────────┐
│   系统API层      │
├─────────────────┤
│ Windows API封装  │
│ 网络通信API      │
│ 文件系统API      │
└─────────────────┘
```

## 模块划分

### 1. 用户交互层

#### 全局快捷键监听模块 (hotkey)
- 负责注册和监听全局快捷键
- 当用户按下预设快捷键时触发翻译流程

#### 区域选择界面模块 (selection)
- 提供屏幕区域选择功能
- 用户可以通过拖拽选择需要翻译的区域

#### 浮动翻译窗口模块 (ui)
- 显示翻译结果的透明浮动窗口
- 支持自定义样式和位置

#### 系统托盘模块 (tray)
- 程序后台运行时的系统托盘图标
- 提供程序控制菜单

### 2. 核心服务层

#### 屏幕捕获服务 (capture)
- 实现屏幕截图功能
- 支持全屏和区域截图

#### OCR识别服务 (ocr)
- 集成OCR引擎进行文字识别
- 处理图像并提取文字内容

#### 翻译处理服务 (translate)
- 集成多种翻译API
- 处理翻译请求并返回结果

#### 配置管理服务 (config)
- 管理用户配置和偏好设置
- 保存和加载配置信息

### 3. 系统API层

#### Windows API封装
- 封装Windows系统调用
- 提供跨平台兼容性支持

#### 网络通信API
- 处理与翻译API的网络通信
- 实现请求和响应处理

#### 文件系统API
- 处理配置文件和缓存文件
- 提供文件读写功能

## 数据流设计

1. **启动阶段**
   - 程序启动 → 初始化各模块 → 注册全局热键 → 进入后台运行状态

2. **翻译流程**
   - 用户按下快捷键 → 触发区域选择 → 截取选择区域 → OCR识别 → 调用翻译API → 显示翻译结果

3. **配置管理**
   - 程序启动时加载配置 → 用户修改配置 → 保存配置到文件 → 实时应用配置更改

## 并发设计

- **主消息循环**: 处理Windows消息和热键事件
- **OCR处理**: 异步处理OCR识别任务
- **翻译请求**: 异步处理翻译API调用
- **UI更新**: 在主线程中更新UI界面

## 错误处理

- 各模块独立处理错误
- 提供统一的错误日志记录
- 向用户显示友好的错误提示